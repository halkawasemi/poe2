<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoE2 Sorceress Build Simulator v2.0</title>
    <style>
        :root {
            --bg-color: #0b0b0b;
            --panel-bg: #141414;
            --card-bg: #1a1a1a;
            --text-main: #dcdcdc;
            --text-muted: #888;
            --text-value: #fff;
            --accent-gold: #c8aa6d;
            --accent-fire: #b7362a;
            --accent-ice: #3a7caf;
            --accent-lightning: #d4b924;
            --accent-pos: #4ece70;
            --accent-neg: #d14e4e;
            --border-color: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }

        h1 { color: var(--accent-gold); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; }
        .subtitle { color: var(--text-muted); margin-bottom: 30px; font-size: 0.9rem; }

        .main-container {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            flex-wrap: wrap;
        }

        /* Skills */
        .skill-list { flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 15px; }
        .skill-card {
            background-color: var(--card-bg); border: 1px solid var(--border-color); padding: 15px; cursor: pointer; transition: all 0.2s;
        }
        .skill-card:hover { border-color: var(--accent-gold); background-color: #222; }
        .skill-card.selected { border-left: 4px solid var(--accent-gold); background-color: #252525; }
        .skill-header { display: flex; justify-content: space-between; align-items: center; }
        .skill-name { font-weight: bold; font-size: 1.1rem; color: var(--text-value); }
        .element-tag { font-size: 0.75rem; padding: 2px 6px; border-radius: 2px; font-weight: bold; color: #fff; }
        .tag-fire { background: var(--accent-fire); }
        .tag-ice { background: var(--accent-ice); }
        .tag-lightning { background: var(--accent-lightning); color: #000; }

        /* Simulator Panel */
        .simulator-panel {
            flex: 2; min-width: 350px; background-color: var(--panel-bg); border: 1px solid var(--border-color); padding: 25px; border-radius: 4px; display: none;
        }
        .simulator-panel.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .panel-header { border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; }
        .panel-title { font-size: 1.4rem; color: var(--text-value); }
        
        .section-title { color: var(--accent-gold); margin-bottom: 15px; font-size: 1rem; text-transform: uppercase; margin-top: 20px; }
        .section-title:first-child { margin-top: 0; }

        /* Support Grid */
        .support-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 30px; }
        .support-gem {
            background: #000; border: 1px solid #444; padding: 10px; border-radius: 4px; cursor: pointer; text-align: center;
            font-size: 0.85rem; color: var(--text-muted); transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .support-gem:hover { border-color: #666; }
        .support-gem.active {
            border-color: var(--accent-gold); color: var(--accent-gold); background: rgba(200, 170, 109, 0.1); box-shadow: 0 0 10px rgba(200, 170, 109, 0.2);
        }
        .gem-icon { width: 12px; height: 12px; border-radius: 50%; background: #444; }
        .support-gem.active .gem-icon { background: var(--accent-gold); }

        /* Stats */
        .stats-container { background: #000; padding: 20px; border-radius: 4px; border: 1px solid #333; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px; }
        .stat-row:last-child { border-bottom: none; margin-bottom: 0; }
        .stat-label { color: var(--text-muted); }
        .stat-val-group { text-align: right; }
        .base-val { color: #555; font-size: 0.85rem; margin-right: 8px; text-decoration: line-through; }
        .final-val { font-weight: bold; color: var(--text-value); }
        
        .diff-pos { color: var(--accent-pos); font-size: 0.8rem; margin-left: 5px;}
        .diff-neg { color: var(--accent-neg); font-size: 0.8rem; margin-left: 5px;}

        .dps-row { margin-top: 15px; padding-top: 10px; border-top: 2px solid #333; }
        .dps-val { font-size: 1.4rem; color: var(--accent-gold); }
        
        /* DoT Specific */
        .dot-row .final-val { color: var(--accent-fire); }
        .dot-label { display: flex; align-items: center; gap: 5px; }
        .dot-badge { font-size: 0.7rem; background: #333; padding: 1px 4px; border-radius: 2px; }

    </style>
</head>
<body>

    <h1>PoE2 Build Simulator v2.0</h1>
    <div class="subtitle">Supports Hit DPS & Ailment DoT Calculation</div>

    <div class="main-container">
        <div class="skill-list" id="skillList"></div>

        <div class="simulator-panel" id="simPanel">
            <div class="panel-header">
                <div class="panel-title" id="simTitle">Skill Name</div>
                <div style="color:#666; font-size:0.9rem; margin-top:5px;" id="simType">Type: Spell, AoE, Fire</div>
            </div>

            <div class="section-title">Support Gems</div>
            <div class="support-grid" id="supportGrid"></div>

            <div class="section-title">Performance Metrics</div>
            <div class="stats-container">
                <div class="stat-row">
                    <span class="stat-label">Hit Damage</span>
                    <div class="stat-val-group" id="statDmg"></div>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Cast Time</span>
                    <div class="stat-val-group" id="statCast"></div>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Mana Cost</span>
                    <div class="stat-val-group" id="statMana"></div>
                </div>
                
                <div class="stat-row dot-row" id="rowDoT">
                    <span class="stat-label dot-label">
                        Ailment DoT <span class="dot-badge" id="dotBadge">Ignite</span>
                    </span>
                    <div class="stat-val-group" id="statDoT"></div>
                </div>

                <div class="stat-row dps-row">
                    <span class="stat-label">Hit DPS (Spam)</span>
                    <div class="stat-val-group dps-val" id="statDPS"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data Definitions ---

        const skills = [
            {
                id: 'meteor',
                name: "Meteor",
                element: "Fire",
                tagClass: "tag-fire",
                tags: ["Spell", "AoE", "Fire"],
                baseDamage: 1250,
                castTime: 1.20,
                manaCost: 45,
                ailmentType: "Ignite",
                ailmentRatio: 0.90 // 90% of base dmg per sec
            },
            {
                id: 'comet',
                name: "Comet",
                element: "Cold",
                tagClass: "tag-ice",
                tags: ["Spell", "AoE", "Cold"],
                baseDamage: 850,
                castTime: 0.90,
                manaCost: 35,
                ailmentType: null, // Chill is non-damaging
                ailmentRatio: 0
            },
            {
                id: 'spark',
                name: "Spark",
                element: "Lightning",
                tagClass: "tag-lightning",
                tags: ["Spell", "Projectile", "Lightning"],
                baseDamage: 280,
                castTime: 0.65,
                manaCost: 18,
                ailmentType: null, // Shock is dmg taken increase
                ailmentRatio: 0
            }
        ];

        // Support Gems with DoT Logic
        const supports = [
            {
                id: 'faster_casting',
                name: "Faster Casting",
                hitMult: 1.0, 
                dotMult: 1.0,      // Does not affect DoT damage
                speedMult: 1.40, 
                manaMult: 1.20
            },
            {
                id: 'conc_effect',
                name: "Conc. Effect",
                hitMult: 1.35, 
                dotMult: 1.35,     // Area DoT also scales (usually)
                speedMult: 1.0,
                manaMult: 1.40
            },
            {
                id: 'controlled_dest',
                name: "Controlled Dest.",
                hitMult: 1.25, 
                dotMult: 1.25,     // Spell Dmg applies to ailments (PoE generic rule)
                speedMult: 1.0,
                manaMult: 1.30
            },
            {
                id: 'deadly_ailments',
                name: "Deadly Ailments",
                hitMult: 0.20,     // 80% Less Hit Damage (0.2x multiplier)
                dotMult: 1.45,     // 45% More Ailment Damage
                speedMult: 1.0,
                manaMult: 1.0
            }
        ];

        // --- State & DOM ---
        let currentSkill = null;
        let activeSupports = new Set();

        const skillListEl = document.getElementById('skillList');
        const simPanelEl = document.getElementById('simPanel');
        const supportGridEl = document.getElementById('supportGrid');
        
        // --- Core Functions ---

        function init() {
            renderSkillList();
        }

        function renderSkillList() {
            skillListEl.innerHTML = '';
            skills.forEach(skill => {
                const card = document.createElement('div');
                card.className = `skill-card ${currentSkill && currentSkill.id === skill.id ? 'selected' : ''}`;
                card.onclick = () => selectSkill(skill);
                card.innerHTML = `
                    <div class="skill-header">
                        <span class="skill-name">${skill.name}</span>
                        <span class="element-tag ${skill.tagClass}">${skill.element}</span>
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-top:5px;">
                        ${skill.ailmentType ? `Scales: ${skill.ailmentType}` : 'No DoT'}
                    </div>
                `;
                skillListEl.appendChild(card);
            });
        }

        function renderSupportGrid() {
            supportGridEl.innerHTML = '';
            supports.forEach(sup => {
                const isActive = activeSupports.has(sup.id);
                const btn = document.createElement('div');
                btn.className = `support-gem ${isActive ? 'active' : ''}`;
                btn.onclick = () => toggleSupport(sup.id);
                
                // Tooltip info logic (simple text)
                let info = [];
                if(sup.hitMult !== 1) info.push(sup.hitMult > 1 ? 'Hit↑' : 'Hit↓');
                if(sup.dotMult !== 1) info.push(sup.dotMult > 1 ? 'DoT↑' : 'DoT↓');
                if(sup.speedMult !== 1) info.push('Speed↑');

                btn.innerHTML = `
                    <span class="gem-icon"></span>
                    <span style="font-weight:bold;">${sup.name}</span>
                    <span style="font-size:0.75rem; color:#555;">${info.join(' / ')}</span>
                `;
                supportGridEl.appendChild(btn);
            });
        }

        function selectSkill(skill) {
            currentSkill = skill;
            activeSupports.clear();
            simPanelEl.classList.add('active');
            
            document.getElementById('simTitle').innerText = skill.name;
            document.getElementById('simType').innerText = skill.tags.join(', ');
            
            // Toggle DoT row visibility
            const dotRow = document.getElementById('rowDoT');
            if (skill.ailmentType) {
                dotRow.style.display = 'flex';
                document.getElementById('dotBadge').innerText = skill.ailmentType;
                document.getElementById('dotBadge').style.color = skill.element === 'Fire' ? '#ffaa00' : '#fff';
            } else {
                dotRow.style.display = 'none';
            }

            renderSkillList();
            renderSupportGrid();
            calculate();
        }

        function toggleSupport(id) {
            if (!currentSkill) return;
            if (activeSupports.has(id)) activeSupports.delete(id);
            else activeSupports.add(id);
            renderSupportGrid();
            calculate();
        }

        // --- Calculation Logic ---

        function calculate() {
            if (!currentSkill) return;

            // Base
            const bDmg = currentSkill.baseDamage;
            const bCast = currentSkill.castTime;
            const bMana = currentSkill.manaCost;
            
            // Base DoT (If applicable)
            // Ignite Base = Hit Dmg * 0.9
            const bDoT = currentSkill.ailmentType ? Math.floor(bDmg * currentSkill.ailmentRatio) : 0;

            // Multipliers
            let mHit = 1.0;
            let mDoT = 1.0;
            let mSpeed = 1.0;
            let mMana = 1.0;

            activeSupports.forEach(supId => {
                const s = supports.find(x => x.id === supId);
                mHit *= s.hitMult;
                mDoT *= s.dotMult;
                mSpeed *= s.speedMult;
                mMana *= s.manaMult;
            });

            // Finals
            const fDmg = Math.floor(bDmg * mHit);
            const fDoT = Math.floor(bDoT * mDoT);
            const fCast = parseFloat((bCast / mSpeed).toFixed(2));
            const fMana = Math.floor(bMana * mMana);
            
            // DPS (Hit)
            const bHitDPS = Math.floor(bDmg / bCast);
            const fHitDPS = Math.floor(fDmg / fCast);

            // Render
            updateRow('statDmg', bDmg, fDmg, '');
            updateRow('statCast', bCast, fCast, 's', true);
            updateRow('statMana', bMana, fMana, '', true);
            
            // Hit DPS
            document.getElementById('statDPS').innerHTML = `
                <span class="final-val">${fHitDPS}</span>
                ${getDiff(bHitDPS, fHitDPS)}
            `;

            // DoT DPS
            if (currentSkill.ailmentType) {
                updateRow('statDoT', bDoT, fDoT, '/sec');
            }
        }

        function updateRow(id, base, final, unit, inverse = false) {
            const el = document.getElementById(id);
            const hasChange = base !== final;
            el.innerHTML = `
                ${hasChange ? `<span class="base-val">${base}${unit}</span>` : ''}
                <span class="final-val">${final}${unit}</span>
                ${hasChange ? getDiff(base, final, inverse) : ''}
            `;
        }

        function getDiff(base, final, inverse = false) {
            const diff = final - base;
            if (diff === 0) return '';
            const isPos = inverse ? diff < 0 : diff > 0;
            const pct = ((diff / base) * 100).toFixed(0);
            return `<span class="${isPos ? 'diff-pos' : 'diff-neg'}">(${diff > 0 ? '+' : ''}${pct}%)</span>`;
        }

        init();
    </script>
</body>
</html>